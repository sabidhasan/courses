<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href=lesson156.css” type=”text/css”>
    <title>Scorekeeper</title>
  </head>

  <body>
    <header class="header">
      <h1>Scorekeeper</h1>
    </header>
    <section class="score">
        <span class="score-data" data-player=1>0</span>
        <span> to </span>
        <span class="score-data" data-player=2>0</span>
    </section>
    <section class="target">
       Playing to <span class="target-score">5</span>
    </section>
    <form class="controls">
      <label for="number">Playing to</label>
      <input type="number" name="number"/>

      <input type="button" class="player" data-player="1" value="Player 1">
      <input type="button" class="player" data-player="2" value="Player 2">
      <input type="button" class="reset" value="Reset">
    </form>
  </body>
  <script type="text/javascript">
    function Scorekeeper(){
      //set basic parameters
      var score = {1: 0, 2: 0};
      this.limit = 5;
      //keeps track of end game
      this.end = false;

      Object.defineProperty(this, "score", {
        get: function() {return score},
        set: function(player) {
          //update score if needed
          if (score[player] < this.limit && this.end === false) score[player] += 1;
          //if limit reached, call end game
          if (score[player] == this.limit) this.end = true;

          this.updateUI();
        }
      });

      this.updateLimit = function(limit) {
        if (!this.end) {
          this.limit = limit;
        }
        this.updateUI();
      }

      this.updateUI = function() {
        //update p1 score (remove class), p2 score (remove class), limit and number box
        //check for win condition
        document.querySelectorAll(".score-data").forEach(player => {
          //update text for player
          let currScore = score[player.dataset.player];
          player.textContent = currScore;
          //update style if win
          if (currScore == this.limit) {
            player.classList.add("win");
          } else {
            player.classList.remove("win")
          }
        });
        document.querySelector(".target-score").textContent = this.limit;
        document.querySelector("input[type='number']").value = this.limit;
      }
      //update the UI
      this.updateUI();
    }

    var state = new Scorekeeper();

    //event handler for reset
    document.querySelector(".reset").addEventListener("click", function() {
      state = new Scorekeeper();
    });

    document.querySelectorAll(".player").forEach(elem => {
      elem.addEventListener("click", function() {
        state["score"] = this.dataset.player;
      })
    });

    document.querySelector("input[type='number']").addEventListener("change", function() {
      state.updateLimit(this.value)
    });
  </script>
</html>
